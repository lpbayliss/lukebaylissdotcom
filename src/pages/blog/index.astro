---
import { getCollection } from "astro:content";
import TerminalPanel from "../../components/TerminalPanel.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = (await getCollection("blog", ({ data }) => !data.draft)).sort(
  (a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime(),
);
---

<BaseLayout title="Writing">
  <TerminalPanel title="Blog" subtitle="essays, notes, and experiments in writing">
    {posts.length === 0 ? (
      <p class="text-sm text-foreground-muted">
        No posts yet. Subscribe to the RSS feed soon to hear when the first entries land.
      </p>
    ) : (
      <ul class="space-y-6 text-sm">
        {posts.map((post) => (
          <li class="space-y-2 border-b border-border pb-4 last:border-b-0 last:pb-0">
            <div>
              <a class="text-lg font-semibold text-foreground" href={`/blog/${post.slug}/`}>
                {post.data.title}
              </a>
              <p class="text-foreground-muted">{post.data.description}</p>
            </div>
            <div class="flex flex-wrap items-center gap-3 text-xs uppercase tracking-[0.25em] text-foreground-muted">
              <time datetime={post.data.publishedAt.toISOString()}>
                {post.data.publishedAt.toLocaleDateString('en-AU', {
                  year: 'numeric',
                  month: 'short',
                  day: '2-digit'
                })}
              </time>
              {post.data.tags.map((tag) => (
                <span class="rounded border border-border px-2 py-1" data-tag={tag}>{tag}</span>
              ))}
            </div>
          </li>
        ))}
      </ul>
    )}
  </TerminalPanel>
</BaseLayout>
