---
import type { CollectionEntry } from "astro:content";
import BackToTop from "../components/BackToTop";
import ReadingProgress from "../components/ReadingProgress";
import BaseLayout from "./BaseLayout.astro";

interface Props {
  entry: CollectionEntry<"snippets">;
}

const { entry } = Astro.props as Props;
const { data } = entry;

// Generate dynamic OG image URL
const ogImageUrl = `${Astro.site}og-image.png?title=${encodeURIComponent(data.title)}&description=${encodeURIComponent(data.description)}&type=snippet`;
---

<BaseLayout
  title={data.title}
  description={data.description}
  ogImage={ogImageUrl}
  ogType="article"
  publishedTime={data.publishedAt}
  modifiedTime={data.updatedAt}
  tags={data.tags}
>
  <ReadingProgress client:load />
  <BackToTop client:load />

  <article class="space-y-6 text-base leading-relaxed text-foreground">
    <header class="mb-8 space-y-2 border-b border-border pb-6">
      <p class="text-xs uppercase tracking-[0.3em] text-foreground-muted">/snippets/{entry.slug}</p>
      <h1 class="text-3xl font-semibold">{data.title}</h1>
      <p class="text-sm text-foreground-muted">{data.description}</p>
      <div class="flex flex-wrap items-center gap-3 text-xs uppercase tracking-[0.25em] text-foreground-muted">
        <time datetime={data.publishedAt.toISOString()}>
          {data.publishedAt.toLocaleDateString('en-AU', {
            year: 'numeric',
            month: 'long',
            day: '2-digit'
          })}
        </time>
        {data.updatedAt && (
          <>
            <span aria-hidden="true">Â·</span>
            <span>
              updated{' '}
              {data.updatedAt.toLocaleDateString('en-AU', {
                year: 'numeric',
                month: 'short',
                day: '2-digit'
              })}
            </span>
          </>
        )}
      </div>
      {data.tags.length > 0 && (
        <ul class="flex flex-wrap gap-2 text-xs uppercase tracking-[0.25em] text-foreground-muted">
          {data.tags.map((tag) => (
            <li class="rounded border border-border px-2 py-1">{tag}</li>
          ))}
        </ul>
      )}
    </header>
    <slot />
  </article>
</BaseLayout>
